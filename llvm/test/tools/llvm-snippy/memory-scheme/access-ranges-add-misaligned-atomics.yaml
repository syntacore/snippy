# RUN: llvm-snippy %s -dump-memory-accesses=%t -model-plugin=None
# RUN: FileCheck %s --input-file=%t

options:
  march: riscv64-linux-gnu
  num-instrs: 200
  mattr: +a
  riscv-disable-misaligned-access: atomics-only

sections:
  - no:        1
    VMA:       0x80000000
    SIZE:      0x400000
    LMA:       0x80000000
    ACCESS:    rx
  - no:        2
    VMA:       0x80600000
    SIZE:      0x400000
    LMA:       0x80600000
    ACCESS:    rw

access-ranges:
  - start: 0x80600000
    size: 0x10
    stride: 8
    first-offset: 0
    last-offset: 1
    misaligned-access: true

  - start: 0x80700000
    size: 0x10
    stride: 8
    first-offset: 0
    last-offset: 1

histogram:
  - [AMOSWAP_D, 1.0]
  - [AMOADD_D, 1.0]
  - [AMOAND_D, 1.0]
  - [AMOOR_D, 1.0]
  - [AMOXOR_D, 1.0]
  - [AMOMAX_D, 1.0]
  - [AMOMAXU_D, 1.0]
  - [AMOMIN_D, 1.0]
  - [AMOMINU_D, 1.0]
  - [LR_D, 1.0]
  - [SC_D, 1.0]

# COM: In 0x80600000 range misaligned accesses are allowed:
# CHECK: 0x80600000
# CHECK: 0x80600008
# CHECK: 0x80600001

# COM: In 0x80600000 range only aligned accesses are allowed because
# COM: of riscv-disable-misaligned-access=atomics-only:
# CHECK: 0x80700000
# CHECK: 0x80700008
# CHECK-NOT: 0x80700001
